generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Calls from Mango Office
model Call {
  id                   Int       @id @default(autoincrement())
  rk                   String
  city                 String
  avitoName            String?   @map("avito_name")
  phoneClient          String    @map("phone_client")
  phoneAts             String    @map("phone_ats")
  dateCreate           DateTime  @map("date_create")
  operatorId           Int       @map("operator_id")
  status               String
  callId               String?   @unique @map("call_id")
  duration             Int?
  recordUrl            String?   @map("record_url")
  recordingPath        String?   @map("recording_path")
  recordingProcessedAt DateTime? @map("recording_processed_at")
  recordingEmailSent   Boolean   @default(false) @map("recording_email_sent")
  mangoData            Json?     @map("mango_data")
  createdAt            DateTime  @default(now()) @map("created_at")
  updatedAt            DateTime  @updatedAt @map("updated_at")
  
  operator        CallcentreOperator @relation(fields: [operatorId], references: [id])
  phone           Phone?             @relation(fields: [phoneAts], references: [number])
  avito           Avito?             @relation("AvitoCalls", fields: [avitoName], references: [name])
  
  @@map("calls")
  @@index([city])
  @@index([dateCreate])
  @@index([operatorId])
  @@index([phoneClient])
  @@index([phoneAts])
  @@index([avitoName])
  @@index([callId])
}

// Related models
model orders {
  id                    Int       @id @default(autoincrement())
  rk                    String
  city                  String
  avitoName             String?
  phone                 String
  typeOrder             String
  clientName            String
  address               String
  dateMeeting           String
  typeEquipment         String
  problem               String
  callRecord            String?
  statusOrder           String
  masterId              Int?
  result                Int?
  expenditure           Int?
  clean                 Int?
  masterChange          Int?
  bsoDoc                String?
  expenditureDoc        String?
  operatorNameId        Int
  createDate            DateTime  @default(now())
  closingData           String?
  avitoChatId           String?
  callId                String?
  prepayment            Int?
  dateClosmod           String?
  comment               String?
  cashSubmissionStatus  String?
  cashSubmissionDate    DateTime?
  cashSubmissionAmount  Int?
  cashReceiptDoc        String?
  cashApprovedBy        Int?
  cashApprovedDate      DateTime?
  directorId            Int?
  callcentreAdminId     Int?
  callcentreOperatorId  Int?
  
  @@map("orders")
}

model CallcentreOperator {
  id             Int       @id @default(autoincrement())
  name           String
  login          String    @unique
  password       String
  city           String
  status         String
  statusWork     String    @map("status_work")
  passport       String?
  contract       String?
  dateCreate     DateTime  @map("date_create")
  note           String?
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedAt      DateTime  @updatedAt @map("updated_at")
  sipAddress     String?   @map("sip_address")
  
  calls          Call[]
  
  @@map("callcentre_operator")
}

model Phone {
  id        Int      @id @default(autoincrement())
  number    String   @unique
  rk        String
  city      String
  avitoName String?  @map("avito_name")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  calls     Call[]
  
  @@map("phones")
}

model Avito {
  id                      Int       @id @default(autoincrement())
  name                    String    @unique
  clientId                String    @map("client_id")
  clientSecret            String    @map("client_secret")
  proxyType               String?   @map("proxy_type")
  proxyHost               String?   @map("proxy_host")
  proxyPort               Int?      @map("proxy_port")
  proxyLogin              String?   @map("proxy_login")
  proxyPassword           String?   @map("proxy_password")
  connectionStatus        String?   @default("not_checked") @map("connection_status")
  proxyStatus             String?   @default("not_checked") @map("proxy_status")
  accountBalance          Float?    @default(0) @map("account_balance")
  adsCount                Int?      @default(0) @map("ads_count")
  viewsCount              Int?      @default(0) @map("views_count")
  contactsCount           Int?      @default(0) @map("contacts_count")
  viewsToday              Int?      @default(0) @map("views_today")
  contactsToday           Int?      @default(0) @map("contacts_today")
  lastSyncAt              DateTime? @map("last_sync_at")
  eternalOnlineEnabled    Boolean?  @default(false) @map("eternal_online_enabled")
  isOnline                Boolean?  @default(false) @map("is_online")
  lastOnlineCheck         DateTime? @map("last_online_check")
  onlineKeepAliveInterval Int?      @default(300) @map("online_keep_alive_interval")
  createdAt               DateTime  @default(now()) @map("created_at")
  updatedAt               DateTime  @updatedAt @map("updated_at")
  
  calls                   Call[]    @relation("AvitoCalls")
  
  @@map("avito")
}



